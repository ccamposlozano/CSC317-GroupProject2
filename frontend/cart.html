<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" type="image/png" href="images/icons/favicon2.png" sizes="16x16">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Lora:400,700|Montserrat:300" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Chivo:300,700|Playfair+Display:700i" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Beth+Ellen|Nova+Cut&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style_index.css">
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/categories.css">
  <title>Cart</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-repeat: no-repeat;
    }

    .container {
      max-width: 1200px;
      margin: 50px auto;
      padding: 20px;
    }

    .card {
      width: 18rem;
    }

    .checkout-container {
      background-color: #f8f9fa;
      color: #000;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #ddd;
    }

    .cart-item h2 {
      font-size: 1.25rem;
      color: #333;
      margin: 0;
    }

    .cart-item p {
      color: #555;
      margin: 0;
    }

    .cart-item-quantity {
      font-size: 1rem;
      color: #888;
    }

    .subtotal {
      font-weight: bold;
      color: #555;
    }

    .checkout-container p {
      color: #555;
    }

    .mb-3 {
      color: #555;
    }
  </style>
</head>

<body>
  <!-- navbar -->
  <nav>
    <div class="logo">
      <h3><a href="merlin.html" class="logo-name">E commerce</a></h3>
    </div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="products.html">Products</a></li>
      <li><a href="categories.html">Categories</a></li>
      <li><a href="cart.html">Cart </a></li>
      <li><a href="contact.html">ContactUs</a></li>
      <li><a href="profile.html">Profile</a></li>
      <li><a href="login.html" id="login">Login</a></li>
    </ul>
    <div class="burger">
      <div class="line1"></div>
      <div class="line2"></div>
      <div class="line3"></div>
    </div>
  </nav>
  <!-- navbar -->

  <div class="container">
    <div id="cart-container"></div>
    <div class="checkout-container">
      <h5 class="mb-3">Summary</h5>
      <p>Subtotal: $<span class="subtotal">0.00</span></p>
      <button class="btn btn-primary checkout-button" onclick="checkout()">Checkout</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
  <script>
    function checkout() {
      window.location.href = 'checkout.html';
    }

    // Fetch cart items from the server and display them
    function getCurrentUserId() {
      const token = localStorage.getItem('token');
      if (!token) {
        console.error('No token found');
        return null;
      }

      try {
        const decodedToken = jwt_decode(token);
        console.log('Decoded Token:', decodedToken);
        console.log('Decoded ID:', decodedToken.id);
        return decodedToken.id;
      } catch (error) {
        console.error('Error decoding token:', error);
        return null;
      }
    }

    const userId = getCurrentUserId();
    console.log('User ID: ', userId);

    if (userId) {
      fetch(`https://csc317ecommerce-c4704680d285.herokuapp.com/api/products/cart/${userId}`)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(cartItems => {
          const cartContainer = document.getElementById('cart-container');
          cartItems.forEach(item => {
            const cartItemElement = document.createElement('div');
            cartItemElement.className = 'cart-item';
            cartItemElement.innerHTML = `
              <div>
                <h2>${item.name}</h2>
                <p>$${item.price}</p>
                <p class="cart-item-quantity">Quantity: ${item.quantity}</p>
              </div>
            `;
            cartContainer.appendChild(cartItemElement);
          });
          updateSummary(cartItems);
        })
        .catch(error => {
          console.error('Error fetching cart items:', error);
        });
    }

    function updateSummary(cartItems) {
      let subtotal = 0;
      cartItems.forEach(item => {
        subtotal += item.price * item.quantity;
      });
      document.querySelector('.subtotal').textContent = subtotal.toFixed(2);
    }
  </script>
</body>

</html>
